<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Attendance ERP - Portal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b1220;
      --card:#121a2b;
      --muted:#8ea0bf;
      --text:#e9eefc;
      --primary:#4f7cff;
      --primary-600:#3a64e6;
      --accent:#22c55e;
      --danger:#ef4444;
      --warning:#f59e0b;
      --ring: rgba(79, 124, 255, .4);
    }
    *{ box-sizing: border-box }
    html, body{ height:100% }
    body{
      margin:0; font-family: Inter, system-ui, -apple-system, sans-serif;
      background: radial-gradient(1200px 800px at 80% -10%, #1a2450 0%, rgba(26,36,80,0) 60%) , var(--bg);
      color: var(--text); line-height:1.55;
    }
    .container{ max-width:1100px; margin:0 auto; padding:24px }
    .card{ background: var(--card); border:1px solid rgba(255,255,255,.06); border-radius:18px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .card.pad{ padding:24px }
    header{ position:sticky; top:0; z-index:10; backdrop-filter: blur(10px); background: linear-gradient(180deg, rgba(11,18,32,.85), rgba(11,18,32,.35)); border-bottom:1px solid rgba(255,255,255,.06) }
    header .row{ display:flex; gap:16px; align-items:center; justify-content:space-between; padding:14px 0 }
    .logo{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.3px }
    .logo .mark{ width:34px; height:34px; border-radius:9px; background: linear-gradient(135deg, var(--primary), #7aa1ff); display:grid; place-items:center; color:white; font-weight:900 }
    .btn{ -webkit-tap-highlight-color: transparent; appearance:none; border:1px solid rgba(255,255,255,.08); padding:10px 14px; border-radius:12px; color:var(--text); background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); cursor:pointer; font-weight:600 }
    .btn:hover{ border-color: rgba(255,255,255,.16) }
    .btn.primary{ background: linear-gradient(180deg, var(--primary), var(--primary-600)); border-color: transparent; box-shadow: 0 10px 18px rgba(79,124,255,.3) }
    .btn.ghost{ background:transparent }
    .btn.danger{ background: linear-gradient(180deg, var(--danger), #b91c1c); border-color: transparent }
    .btn.success{ background: linear-gradient(180deg, var(--accent), #16a34a); border-color: transparent }
    .btn.small{ padding:8px 10px; font-size:.9rem; border-radius:10px }
    .grid{ display:grid; gap:16px }
    .grid.cols-2{ grid-template-columns: repeat(2, minmax(0,1fr)) }
    .grid.cols-3{ grid-template-columns: repeat(3, minmax(0,1fr)) }
    .field{ display:grid; gap:8px }
    .field label{ color: var(--muted); font-size:.9rem }
    .input, select, textarea{ width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.09); background: rgba(255,255,255,.02); color: var(--text) }
    .input:focus, select:focus, textarea:focus{ outline:none; border-color: var(--primary); box-shadow: 0 0 0 4px var(--ring) }
    .row{ display:flex; gap:12px; align-items:center }
    .right{ margin-left:auto }
    .hide{ display:none !important }
    table{ width:100%; border-collapse: collapse; border-spacing:0; overflow:hidden; border-radius:14px; font-size:.95rem }
    th, td{ padding:12px 12px; text-align:left; border-bottom:1px solid rgba(255,255,255,.06) }
    thead th{ position:sticky; top:0; background: rgba(255,255,255,.06); z-index:1 }
    tbody tr:hover td{ background: rgba(255,255,255,.03) }
    .chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; font-weight:600; font-size:.85rem }
    .chip.ok{ background: rgba(34,197,94,.15); color:#22c55e; border:1px solid rgba(34,197,94,.25) }
    .chip.bad{ background: rgba(239,68,68,.15); color:#ef4444; border:1px solid rgba(239,68,68,.25) }
    .chip.warn{ background: rgba(245,158,11,.15); color:#f59e0b; border:1px solid rgba(245,158,11,.25) }
    .auth-wrap{ min-height:calc(100vh - 70px); display:grid; place-items:center; padding:24px }
    .auth{ width:min(980px, 100%); display:grid; grid-template-columns: 1.2fr 1fr; gap:18px }
    .auth .illustration{ background: radial-gradient(700px 400px at 0% -10%, rgba(79,124,255,.25), transparent), linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border-radius:18px; padding:26px }
    .auth h1{ margin:0 0 10px 0; font-size:2rem }
    .auth p{ margin:0; color: var(--muted) }
    .dash{ display:grid; grid-template-columns: 250px 1fr; gap:18px; min-height: calc(100vh - 110px) }
    .side{ position:sticky; top:86px; height: fit-content; }
    .nav{ display:grid; gap:8px }
    .nav .item{ display:flex; gap:10px; padding:10px 12px; border-radius:12px; cursor:pointer; color: var(--muted); border:1px solid transparent }
    .nav .item.active, .nav .item:hover{ color: var(--text); background: rgba(255,255,255,.06); border-color: rgba(255,255,255,.08) }
    .section{ display:grid; gap:16px }
    .stats{ display:grid; grid-template-columns: repeat(4, minmax(0,1fr)); gap:12px }
    .stat{ padding:16px; border-radius:14px; background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.06) }
    .stat .big{ font-size:1.6rem; font-weight:800 }
    .pill{ font-size:.8rem; color:var(--muted); border:1px dashed rgba(255,255,255,.15); padding:6px 10px; border-radius:999px }
    .modal{ position:fixed; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,.7); display:grid; place-items:center; z-index:100 }
    .modal-content{ max-width:500px; width:90%; background: var(--card); border-radius:18px; padding:24px; border:1px solid rgba(255,255,255,.1) }
    .modal h3{ margin-top:0 }
    @media (max-width:1000px){
      .auth{ grid-template-columns: 1fr }
      .dash{ grid-template-columns: 1fr }
      .side{ position:relative; top:0 }
      .stats{ grid-template-columns: repeat(2, minmax(0,1fr)) }
    }
  </style>
</head>
<body>
  <header>
    <div class="container row">
      <div class="logo">
        <div class="mark">UGI</div>
        <div>UGIverse <span class="pill">Attendance ERP</span></div>
      </div>
      <div class="row">
        <button class="btn ghost" id="navHomeBtn">Home</button>
        <button class="btn ghost hide" id="navLogoutBtn">Logout</button>
      </div>
    </div>
  </header>

  <!-- AUTH -->
  <main class="auth-wrap" id="authPage">
    <div class="auth">
      <div class="illustration card">
        <h1>Admin, Teacher & Student Portal</h1>
        <p>Developed by <strong>UGIverse</strong></p>
        <p>Your whole college universe in one website</p>
        <div style="height:16px"></div>
        <div class="grid cols-2">
          <div class="stat">
            <div class="big" id="statStudents">0</div>
            <div class="muted">Students</div>
          </div>
          <div class="stat">
            <div class="big" id="statTeachers">0</div>
            <div class="muted">Teachers</div>
          </div>
          <div class="stat">
            <div class="big" id="statToday">0%</div>
            <div class="muted">Today Present</div>
          </div>
          <div class="stat">
            <div class="big" id="statRecords">0</div>
            <div class="muted">Records</div>
          </div>
        </div>
      </div>

      <div class="card pad">
        <h2 style="margin:0 0 8px 0">Login</h2>
        <div class="grid">
          <div class="field">
            <label>Login as</label>
            <div class="row">
              <label class="row"><input type="radio" name="role" value="admin"> &nbsp;Admin</label>
              <label class="row"><input type="radio" name="role" value="teacher" checked> &nbsp;Teacher</label>
              <label class="row"><input type="radio" name="role" value="student"> &nbsp;Student</label>
            </div>
          </div>
          <div class="field">
            <label>Email / ID</label>
            <input class="input" id="loginId" placeholder="Enter email or ID" />
          </div>
          <div class="field">
            <label>Password</label>
            <div class="row" style="width:100%">
              <input class="input" id="loginPass" type="password" placeholder="Enter your password" style="flex:1" />
              <button class="btn small" id="togglePass" type="button">Show</button>
            </div>
          </div>
          <div class="row">
            <button class="btn primary" id="loginBtn">Sign in</button>
            <div class="right" id="loginMsg" style="color:var(--warning)"></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- DASHBOARD -->
  <section class="container dash hide" id="dash">
    <aside class="side card pad">
      <div class="row" style="justify-content:space-between">
        <div id="userName" style="font-weight:800">User</div>
        <div class="pill" id="userRole">teacher</div>
      </div>
      <div class="nav" id="nav"></div>
      <div class="row" style="margin-top:10px">
        <button class="btn small right" id="logoutBtn">Logout</button>
      </div>
    </aside>

    <main class="section" id="mainContent"></main>
  </section>

  <!-- Payment Modal -->
  <div id="paymentModal" class="modal hide">
    <div class="modal-content">
      <h3>Pay Fees</h3>
      <p>Amount Due: ₹<span id="payAmount">0</span></p>
      <div class="grid">
        <div class="field">
          <label>Card Number</label>
          <input class="input" id="cardNum" placeholder="1234 5678 9012 3456" />
        </div>
        <div class="grid cols-2">
          <div class="field">
            <label>Expiry</label>
            <input class="input" id="cardExp" placeholder="MM/YY" />
          </div>
          <div class="field">
            <label>CVV</label>
            <input class="input" id="cardCvv" placeholder="123" />
          </div>
        </div>
        <div class="row">
          <button class="btn success" id="confirmPayBtn">Confirm Payment</button>
          <button class="btn" id="cancelPayBtn">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const $ = (q, root=document) => root.querySelector(q);
    const $$ = (q, root=document) => Array.from(root.querySelectorAll(q));
    const todayISO = () => new Date().toISOString().slice(0,10);
    const monISO = () => new Date().toISOString().slice(0,7);

    const db = {
      get(key, fallback){
        try{ return JSON.parse(localStorage.getItem(key)) ?? fallback }catch{ return fallback }
      },
      set(key, val){ localStorage.setItem(key, JSON.stringify(val)) }
    }

    const store = {
      admins: 'sl_admins',
      teachers: 'sl_teachers',
      students: 'sl_students',
      attendance: 'sl_attendance',
      fees: 'sl_fees',
      assignments: 'sl_assignments'
    }

    function uid(prefix='U'){
      return prefix + Math.random().toString(36).slice(2,8).toUpperCase();
    }

    function seedDemo(){
      const admins = [
        { id: 'A001', role:'admin', email:'admin@ugi.edu', password:'admin@123', name:'Admin User' }
      ];
      
      const teachers = [
        { id: 'T001', role:'teacher', email:'jitendra@ugi.edu', password:'teacher123', name:'Jitendra Kumar' },
        { id: 'T002', role:'teacher', email:'naman@ugi.edu', password:'teacher123', name:'Naman Jaiswal' }
      ];

      const students = [
        { id:'176', name:'Utsav Dwivedi', roll:'2204280100176', class:'CS-7A', email:'utsavdwivedi51@gmail.com', password:'utsav@123' },
        { id:'169', name:'Shristi Tripathi', roll:'2204280100169', class:'CS-7A', email:'shristi66@gmail.com', password:'shristi@123' },
        { id:'150', name:'Raj Dwivedi', roll:'2204280100150', class:'CS-7B', email:'rajdwivedi@gmail.com', password:'raj@123' }
      ];

      const fees = [
        { studentId: '176', totalFees: 50000, paidFees: 25000, dueDate: '2026-02-15' },
        { studentId: '169', totalFees: 50000, paidFees: 50000, dueDate: '2026-02-15' },
        { studentId: '150', totalFees: 50000, paidFees: 10000, dueDate: '2026-02-15' }
      ];

      const assignments = [
        { id: 'A001', title: 'Data Structures Assignment', class: 'CS-7A', dueDate: '2026-01-20', description: 'Implement BST operations', teacherId: 'T001' },
        { id: 'A002', title: 'Algorithm Analysis', class: 'CS-7B', dueDate: '2026-01-25', description: 'Analyze time complexity', teacherId: 'T002' }
      ];

      const attendance = [];
      const now = new Date();
      for(let d=0; d<10; d++){
        const date = new Date(now);
        date.setDate(now.getDate()-d);
        const iso = date.toISOString().slice(0,10);
        for(const s of students){
          const present = Math.random() > 0.15;
          attendance.push({date: iso, studentId: s.id, status: present ? 'P' : 'A'});
        }
      }

      db.set(store.admins, admins);
      db.set(store.teachers, teachers);
      db.set(store.students, students);
      db.set(store.attendance, attendance);
      db.set(store.fees, fees);
      db.set(store.assignments, assignments);
      db.set('sl_seeded', true);
    }

    if(!db.get('sl_seeded', false)){ seedDemo() }

    const auth = {
      current: null,
      login(idOrEmail, password, role){
        let users = [];
        if(role === 'admin') users = db.get(store.admins, []);
        else if(role === 'teacher') users = db.get(store.teachers, []);
        else users = db.get(store.students, []);

        const u = users.find(u=> (u.email?.toLowerCase()===idOrEmail.toLowerCase() || u.id===idOrEmail) && u.password===password);
        if(u){
          this.current = {...u, role};
          sessionStorage.setItem('sl_user', JSON.stringify(this.current));
          return {ok:true, user:this.current}
        }
        return {ok:false, msg:'Invalid credentials'}
      },
      logout(){ this.current=null; sessionStorage.removeItem('sl_user') },
      load(){ try{ this.current = JSON.parse(sessionStorage.getItem('sl_user')); return this.current }catch{ return null } }
    }

    function refreshLandingStats(){
      const students = db.get(store.students, []);
      const teachers = db.get(store.teachers, []);
      const att = db.get(store.attendance, []);
      const today = todayISO();
      const todays = att.filter(r=>r.date===today);
      const present = todays.filter(r=>r.status==='P').length;
      $('#statStudents').textContent = students.length;
      $('#statTeachers').textContent = teachers.length;
      $('#statRecords').textContent = att.length;
      $('#statToday').textContent = todays.length? Math.round(present/todays.length*100)+'%':'0%';
    }

    function show(el){ el.classList.remove('hide') }
    function hide(el){ el.classList.add('hide') }

    function renderAdminDashboard(){
      const nav = $('#nav');
      nav.innerHTML = `
        <div class="item active" data-view="admin-overview">Overview</div>
        <div class="item" data-view="admin-students">Manage Students</div>
        <div class="item" data-view="admin-teachers">Manage Teachers</div>
        <div class="item" data-view="admin-fees">Fees Management</div>
      `;

      showAdminOverview();

      nav.addEventListener('click', (e)=>{
        const item = e.target.closest('.item');
        if(!item) return;
        $$('.nav .item').forEach(i=> i.classList.remove('active'));
        item.classList.add('active');
        const view = item.dataset.view;
        if(view === 'admin-overview') showAdminOverview();
        else if(view === 'admin-students') showAdminStudents();
        else if(view === 'admin-teachers') showAdminTeachers();
        else if(view === 'admin-fees') showAdminFees();
      });
    }

    function showAdminOverview(){
      const students = db.get(store.students, []);
      const teachers = db.get(store.teachers, []);
      const att = db.get(store.attendance, []);
      const today = todayISO();
      const todays = att.filter(r=>r.date===today);
      const present = todays.filter(r=>r.status==='P').length;

      $('#mainContent').innerHTML = `
        <div class="card pad">
          <h2 style="margin:0">Admin Overview</h2>
          <p style="color:var(--muted)">System statistics</p>
          <div class="stats" style="margin-top:14px">
            <div class="stat">
              <div class="big">${students.length}</div>
              <div>Students</div>
            </div>
            <div class="stat">
              <div class="big">${teachers.length}</div>
              <div>Teachers</div>
            </div>
            <div class="stat">
              <div class="big">${todays.length? Math.round(present/todays.length*100)+'%':'0%'}</div>
              <div>Present Today</div>
            </div>
            <div class="stat">
              <div class="big">${att.length}</div>
              <div>Total Records</div>
            </div>
          </div>
        </div>
      `;
    }

    function showAdminStudents(){
      const students = db.get(store.students, []);
      let html = `
        <div class="card pad">
          <h2 style="margin:0">Manage Students</h2>
          <p style="color:var(--muted)">Add or remove students</p>
          <div class="grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Name</label>
              <input class="input" id="newStuName" placeholder="Student Name" />
            </div>
            <div class="field">
              <label>Roll No</label>
              <input class="input" id="newStuRoll" placeholder="Roll Number" />
            </div>
            <div class="field">
              <label>Class</label>
              <input class="input" id="newStuClass" placeholder="Class" />
            </div>
            <div class="field">
              <label>Email</label>
              <input class="input" id="newStuEmail" placeholder="Email" />
            </div>
            <div class="field">
              <label>Password</label>
              <input class="input" id="newStuPass" placeholder="Password" />
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button class="btn success" id="addStuBtn">Add Student</button>
            </div>
          </div>
          <div class="card" style="padding:0; margin-top:12px">
            <table>
              <thead>
                <tr><th>ID</th><th>Name</th><th>Roll</th><th>Class</th><th>Email</th><th>Actions</th></tr>
              </thead>
              <tbody id="adminStuTbody"></tbody>
            </table>
          </div>
        </div>
      `;
      $('#mainContent').innerHTML = html;

      const tbody = $('#adminStuTbody');
      students.forEach(s=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.id}</td>
          <td>${s.name}</td>
          <td>${s.roll}</td>
          <td>${s.class}</td>
          <td>${s.email}</td>
          <td><button class="btn small danger" data-id="${s.id}" onclick="deleteStu('${s.id}')">Delete</button></td>
        `;
        tbody.appendChild(tr);
      });

      $('#addStuBtn').addEventListener('click', ()=>{
        const name = $('#newStuName').value.trim();
        const roll = $('#newStuRoll').value.trim();
        const cls = $('#newStuClass').value.trim();
        const email = $('#newStuEmail').value.trim();
        const pass = $('#newStuPass').value.trim();
        if(!name || !roll || !cls || !email || !pass){ alert('All fields required'); return }
        const students = db.get(store.students, []);
        const id = uid('S');
        students.push({id, name, roll, class:cls, email, password:pass});
        db.set(store.students, students);
        showAdminStudents();
      });
    }

    window.deleteStu = function(id){
      if(!confirm('Delete this student?')) return;
      let students = db.get(store.students, []);
      students = students.filter(s=> s.id !== id);
      db.set(store.students, students);
      showAdminStudents();
    }

    function showAdminTeachers(){
      const teachers = db.get(store.teachers, []);
      let html = `
        <div class="card pad">
          <h2 style="margin:0">Manage Teachers</h2>
          <p style="color:var(--muted)">Add or remove teachers</p>
          <div class="grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Name</label>
              <input class="input" id="newTeachName" placeholder="Teacher Name" />
            </div>
            <div class="field">
              <label>Email</label>
              <input class="input" id="newTeachEmail" placeholder="Email" />
            </div>
            <div class="field">
              <label>Password</label>
              <input class="input" id="newTeachPass" placeholder="Password" />
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button class="btn success" id="addTeachBtn">Add Teacher</button>
            </div>
          </div>
          <div class="card" style="padding:0; margin-top:12px">
            <table>
              <thead>
                <tr><th>ID</th><th>Name</th><th>Email</th><th>Actions</th></tr>
              </thead>
              <tbody id="adminTeachTbody"></tbody>
            </table>
          </div>
        </div>
      `;
      $('#mainContent').innerHTML = html;

      const tbody = $('#adminTeachTbody');
      teachers.forEach(t=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${t.id}</td>
          <td>${t.name}</td>
          <td>${t.email}</td>
          <td><button class="btn small danger" onclick="deleteTeach('${t.id}')">Delete</button></td>
        `;
        tbody.appendChild(tr);
      });

      $('#addTeachBtn').addEventListener('click', ()=>{
        const name = $('#newTeachName').value.trim();
        const email = $('#newTeachEmail').value.trim();
        const pass = $('#newTeachPass').value.trim();
        if(!name || !email || !pass){ alert('All fields required'); return }
        const teachers = db.get(store.teachers, []);
        const id = uid('T');
        teachers.push({id, name, email, password:pass, role:'teacher'});
        db.set(store.teachers, teachers);
        showAdminTeachers();
      });
    }

    window.deleteTeach = function(id){
      if(!confirm('Delete this teacher?')) return;
      let teachers = db.get(store.teachers, []);
      teachers = teachers.filter(t=> t.id !== id);
      db.set(store.teachers, teachers);
      showAdminTeachers();
    }

    function showAdminFees(){
      const students = db.get(store.students, []);
      const fees = db.get(store.fees, []);
      const feeMap = new Map(fees.map(f=> [f.studentId, f]));

      let html = `
        <div class="card pad">
          <h2 style="margin:0">Fees Management</h2>
          <p style="color:var(--muted)">View student fees status</p>
          <div class="card" style="padding:0; margin-top:12px">
            <table>
              <thead>
                <tr><th>Student</th><th>Roll</th><th>Total Fees</th><th>Paid</th><th>Due</th><th>Status</th></tr>
              </thead>
              <tbody id="adminFeesTbody"></tbody>
            </table>
          </div>
        </div>
      `;
      $('#mainContent').innerHTML = html;

      const tbody = $('#adminFeesTbody');
      students.forEach(s=>{
        const f = feeMap.get(s.id) || {totalFees:50000, paidFees:0};
        const due = f.totalFees - f.paidFees;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${s.name}</td>
          <td>${s.roll}</td>
          <td>₹${f.totalFees}</td>
          <td>₹${f.paidFees}</td>
          <td>₹${due}</td>
          <td><span class="chip ${due===0?'ok':'bad'}">${due===0?'Paid':'Due'}</span></td>
        `;
        tbody.appendChild(tr);
      });
    }

    function renderTeacherDashboard(){
      const nav = $('#nav');
      nav.innerHTML = `
        <div class="item active" data-view="teacher-attendance">Take Attendance</div>
        <div class="item" data-view="teacher-assignments">Assignments</div>
        <div class="item" data-view="teacher-reports">Reports</div>
      `;

      showTeacherAttendance();

      nav.addEventListener('click', (e)=>{
        const item = e.target.closest('.item');
        if(!item) return;
        $$('.nav .item').forEach(i=> i.classList.remove('active'));
        item.classList.add('active');
        const view = item.dataset.view;
        if(view ===
