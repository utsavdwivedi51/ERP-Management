<!DOCTYPE html>
<html>
<head>
<title>UGIverse ERP Cloud</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:Inter,Arial;background:#0b1220;color:white}
header{background:#121a2b;padding:16px;font-size:20px;font-weight:700}
.container{display:grid;grid-template-columns:240px 1fr;height:100vh}
nav{background:#0f172a;padding:20px}
nav div{padding:12px;border-radius:8px;cursor:pointer}
nav div:hover{background:#1e293b}
main{padding:20px;overflow:auto}
.card{background:#121a2b;padding:16px;border-radius:14px;margin-bottom:14px}
button,input{padding:10px;border-radius:8px;border:none}
button{background:#4f7cff;color:white}
</style>
</head>
<body>

<header>UGIverse ERP Cloud</header>
<div id="loginBox" class="card">
<select id="role"><option>admin</option><option>teacher</option><option>student</option></select>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<div class="container" id="dashboard" style="display:none">
<nav>
<div onclick="loadSection('home')">ğŸ  Dashboard</div>
<div id="navFees" onclick="loadSection('fees')">ğŸ’° Fees</div>
<div id="navAttend" onclick="loadSection('attendance')">ğŸ“… Attendance</div>
<div id="navAssign" onclick="loadSection('assignments')">ğŸ“š Assignments</div>
<div onclick="logout()">ğŸšª Logout</div>
</nav>
<main id="main"></main>
</div>

<script>
const firebaseConfig={ /* YOUR CONFIG */ };
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore(),auth=firebase.auth();
let currentRole="";

function login(){
 auth.signInWithEmailAndPassword(email.value,password.value).then(r=>{
  db.collection("users").doc(r.user.uid).get().then(d=>{
    currentRole=d.data().role;
    loginBox.style.display="none";
    dashboard.style.display="grid";
    roleProtection();
    loadSection("home");
  })
 })
}

function logout(){auth.signOut();location.reload();}

/* ROLE SECURITY */
function roleProtection(){
 if(currentRole=="student"){
  navFees.style.display="block";
  navAttend.style.display="block";
 }
 if(currentRole=="teacher"){
  navFees.style.display="none";
 }
 if(currentRole=="admin"){
  navFees.style.display="block";
 }
}

/* DASHBOARD */
function loadSection(sec){
 if(sec=="home"){
  main.innerHTML=`
  <h2>ğŸ“Š Analytics Dashboard</h2>
  <div class="card"><canvas id="attChart"></canvas></div>
  <div class="card"><canvas id="feeChart"></canvas></div>`;
  loadCharts();
 }
 if(sec=="assignments") main.innerHTML="<div class='card'>Assignments Section</div>";
}

/* ANALYTICS */
function loadCharts(){
 const start = new Date();
 start.setDate(1);
 const startDate = start.toISOString().slice(0,10);

 db.collection("attendance").where("date",">=",startDate).get().then(snap=>{
  let P=0,A=0;
  snap.forEach(d=>d.data().status=="P"?P++:A++);
  new Chart(document.getElementById("attChart"),{
   type:"doughnut",
   data:{labels:["Present","Absent"],datasets:[{data:[P,A]}]}
  });
 });

 db.collection("fees").get().then(snap=>{
  let paid=0,due=0;
  snap.forEach(d=>{
   let f=d.data();
   paid+=f.paid;
   due+=(f.total-f.paid);
  });
  new Chart(document.getElementById("feeChart"),{
   type:"bar",
   data:{labels:["Paid","Due"],datasets:[{data:[paid,due]}]}
  });
 });
}
</script>
</body>
</html>
